<!--
  ~ Changes to this file committed after and not including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ This file is part of Hopsworks
  ~ Copyright (C) 2018, Logical Clocks AB. All rights reserved
  ~
  ~ Hopsworks is free software: you can redistribute it and/or modify it under the terms of
  ~ the GNU Affero General Public License as published by the Free Software Foundation,
  ~ either version 3 of the License, or (at your option) any later version.
  ~
  ~ Hopsworks is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
  ~ PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.
  ~ If not, see <https://www.gnu.org/licenses/>.
  ~
  ~ Changes to this file committed before and including commit-id: ccc0d2c5f9a5ac661e60e6eaf138de7889928b8b
  ~ are released under the following license:
  ~
  ~ Copyright (C) 2013 - 2018, Logical Clocks AB and RISE SICS AB. All rights reserved
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of this
  ~ software and associated documentation files (the "Software"), to deal in the Software
  ~ without restriction, including without limitation the rights to use, copy, modify, merge,
  ~ publish, distribute, sublicense, and/or sell copies of the Software, and to permit
  ~ persons to whom the Software is furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all copies or
  ~ substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS  OR IMPLIED, INCLUDING
  ~ BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  ~ NONINFRINGEMENT. IN NO EVENT SHALL  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
  ~ DAMAGES OR  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>


  <div id="wrapper" ng-class="{'toggled': projectCtrl.isClosed}" ng-controller="ProjectCtrl as projectCtrl">
    <div class="overlay"></div>

    <div ng-include="'navProject.html'"></div>
    <div ng-if="mainCtrl.showSearchPage" class="content-wrapper">
      <div id="projectSearchResults">
        <div ng-include="'views/search/search.html'"></div>
      </div>
    </div>
    <div ng-if="!mainCtrl.showSearchPage" class="job-content-wrapper">
      <h3 id="projectBread"> {{ projectCtrl.currentProject.projectName}} / Jobs</h3>
    </div>
    <div ng-if="!mainCtrl.showSearchPage" class="">
      <section>
        <div class="content-wrapper">
          <h3 id="projectSettings" style="display: none;"> {{ projectCtrl.currentProject.projectName}} Settings</h3>
          <div ng-controller="PythonCtrl as pythonCtrl"  ng-init="indextab = 0">
            <uib-tabset active="indextab">
              <uib-tab index="0" heading="Project Settings">

                <form role="form" name="projectForm" ng-submit="projectCtrl.saveProject()">

                  <h2>Project Settings</h2>
                  <div class="panel panel-default"  style="width: 800px; background-color: #F7F7F7;">
                    <div class="panel-body">
                      <div id="updateSettings">

                        <div class="row">

                          <div class="col-md-7">
                            <fieldset>
                              <div class="control-group col-md-offset-1">
                                <label class="control-label">Name</label>
                                <div class="controls">
                                  <input class="form-control" name="project_name"
                                         type="text"
                                         id="projectname"
                                         ng-model="projectCtrl.currentProject.projectName"
                                         disabled>
                                </div>
                                <p></p>
                                <label class="control-label">ID</label>
                                <div class="controls">
                                  <input class="form-control" name="id"
                                         type="text"
                                         id="id"
                                         ng-model="projectCtrl.projectId"
                                         disabled>
                                </div>
                                <p></p>
                                <label class="control-label">Description</label>
                                <div class="controls">
                                  <textarea class="form-control" style="resize:none;"
                                            ng-model="projectCtrl.currentProject.description"
                                            rows="3">
                                  </textarea>
                                </div>
                                <p></p>
                                <label class="control-label">Data Retention Period</label>
                                <div class='input-group date col-md-8' id='schedulePicker'>
                                  <input id="dpInput" type="text" ng-model="projectCtrl.currentProject.retentionPeriod" data-format="YYYY-MM-DD" class="form-control">
                                  <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                  </span>
                                </div>
                                <script type="text/javascript">
                                              $(function () {
                                                $('#schedulePicker').datetimepicker({
                                                  format: 'YYYY-MM-DD'
                                                }).on('dp.change', function (e) {
                                                  $('#dpInput').trigger('input');
                                                });
                                              });</script>

                                <p></p>
                              </div>
                            </fieldset>
                          </div>

                          <div class="col-md-5">
                            <label class="control-label">Quotas</label>
                            <fieldset>
                              <label class="text-muted">Datasets</label>
                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.hdfsUsage()}} of {{projectCtrl.hdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hdfsNsQuota() === -1">
                                    {{projectCtrl.hdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hdfsNsQuota() !== -1">
                                    {{projectCtrl.hdfsNsCount()}} files of {{projectCtrl.hdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset ng-if="projectCtrl.isServiceEnabled('HIVE')">
                              <label class="text-muted">Hive Database</label>

                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hiveHdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.hiveHdfsUsage()}} of {{projectCtrl.hiveHdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.hiveHdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hiveHdfsNsQuota() === -1">
                                    {{projectCtrl.hiveHdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.hiveHdfsNsQuota() !== -1">
                                    {{projectCtrl.hiveHdfsNsCount()}} files of {{projectCtrl.hiveHdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset ng-if="projectCtrl.isServiceEnabled('FEATURESTORE')">
                              <label class="text-muted">Feature Store</label>

                              <div class="row" style="margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.featurestoreHdfsQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px">
                                    {{projectCtrl.featurestoreHdfsUsage()}} of {{projectCtrl.featurestoreHdfsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                              <div class="row" style="margin-top: 10px; margin-left:15px; margin-bottom:0px">
                                <fieldset ng-if="projectCtrl.featurestoreHdfsNsCount() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.featurestoreHdfsNsQuota() === -1">
                                    {{projectCtrl.featurestoreHdfsNsCount()}} files
                                  </span>
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" ng-show="projectCtrl.featurestoreHdfsNsQuota() !== -1">
                                    {{projectCtrl.featurestoreHdfsNsCount()}} files of {{projectCtrl.featurestoreHdfsNsQuota()}} used
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset>
                              <label class="text-muted">CPU</label>
                              <div class="row" style="margin-left:15px; margin-bottom:10px">
                                <fieldset ng-if="projectCtrl.yarnQuota() != null">
                                  <span style="margin-top: 40px; margin-left:10px; margin-bottom:0px" >
                                    {{projectCtrl.yarnQuota()}} CPU hours
                                  </span>
                                </fieldset>
                              </div>
                            </fieldset>

                            <fieldset>
                              <label class="text-muted" ng-show="projectCtrl.allServicesSelected()">Services</label>
                              <div class="control-group col-md-offset-1">
                                <div class="row" ng-repeat="projectType in projectCtrl.projectTypes">
                                  <md-checkbox class=" row md-primary" ng-click="projectCtrl.exists(projectType)">
                                    {{ projectType}}
                                  </md-checkbox>
                                </div>
                              </div>
                            </fieldset>
                            <div class="row" style="margin-left:15px; margin-bottom:0px">
                              <button class="btn btn-success" type="button"

                                      ng-disabled="projectCtrl.working"
                                      ng-click="projectCtrl.getCerts()">
                                Export Certificates
                              </button>
                              <!-- <i class="fa fa-info-circle" uib-tooltip="Click to download project's certificates. It allows communication with the project's services from outside Hospworks." style="margin-left: 10px; margin-bottom:0px"></i> -->
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                  <button class="btn btn-primary" type="submit"
                          ng-disabled="projectCtrl.working">
                    <i ng-if="projectCtrl.working" style="margin-top: 2px" class="fa fa-spinner fa-spin pull-right" ></i>
                    Save
                  </button>

                </form>

              </uib-tab>
              <uib-tab index="1" heading="Default Job Configuration">
                <h2>Default job configuration</h2>
                <div class="panel panel-default">
                  <div class="panel-body">
                    <h5>Set a default Job Configuration for all new Jobs. The Python and Spark configuration may also be imported in your Jupyter settings.</h5>
                    <div ng-include="'views/newJob.html'"></div>
                  </div>
                </div>
              </uib-tab>
            </uib-tabset>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
